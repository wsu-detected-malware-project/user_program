using System;
using System.IO;
using System.Linq;
using System.Text;
using System.Windows.Forms;

public static class MalwareCleaner
{
    public static void DeleteFiles(string resultCsvPath, double threshold = 0.7)
    {
        if (!File.Exists(resultCsvPath))
        {
            MessageBox.Show("result.csv 파일을 찾을 수 없습니다.");
            return;
        }

        var lines = File.ReadAllLines(resultCsvPath, Encoding.UTF8);
        if (lines.Length <= 1)
        {
            MessageBox.Show("result.csv에 검사 결과가 없습니다.");
            return;
        }

        int deletedCount = 0;
        foreach (var line in lines.Skip(1))
        {
            var parts = line.Split(',');
            if (parts.Length < 4)
                continue;

            if (double.TryParse(parts[1], out double score) && score >= threshold)
            {
                string path = parts[3].Trim('"').Trim();
                if (File.Exists(path))
                {
                    try
                    {
                        //File.Delete(path);
                        MessageBox.Show("삭제 예정: " + path); //테스트 시 위 file.delete 주석 처리하고 해당 코드 사용 -> 파일 삭제 대신 메세지를 띄워 삭제될 파일들을 보여줌
                        deletedCount++;
                    }
                    catch (Exception ex)
                    {
                        MessageBox.Show($"파일 삭제 실패:\n{path}\n{ex.Message}", "삭제 오류");
                    }
                }
            }
        }

        MessageBox.Show($"삭제 완료: {deletedCount}개 파일 삭제됨", "악성 파일 제거");
    }
}
